{% extends 'base.html'%}
{% load crispy_forms_tags %}
  {%block content%}
    <h1>Search</h1>
      <form class="" action="{% url 'home'%}" method="post">
        {% csrf_token %}
        <fieldset>
          {{ form|crispy }}
        </fieldset>
        <div class="form-group">
          <button class="btn btn-outline-dark">Search</button>
        </div>
      </form>
    <h1>Events</h1>
    {%for event in events%}
      <div class="card my-3">
        <div class="card-header">
          <h2 class="d-inline">
            <a href="{% url 'event detail' event.id %}"> {{event.name|capfirst}} </a>
          </h2>
          <h4 class="d-inline">by
            <a href="{% url 'profile' event.author.id %}">{{event.author}}</a>
            <img src="{{ event.author.profile.image.url }}" class="rounded-circle" height="40px" alt="">
          </h4>
          <h3>{{event.category}}</h3>

          {% if event.author.id == user.id %}
            <a class="btn btn-primary" href="{%url 'event edit' event.id%}">Edit</a>
          {% endif %}

          {% if user not in event.signed_up.all %}
            <a class="btn btn-secondary" href="{% url 'event signup' event.id %}">Signup</a>
          {% else %}
            <a class="btn btn-danger" href="{% url 'event cancel signup'  event.id %}">Cancel</a>
          {% endif %}
        </div>
        <div class="card-body text-nowrap">
          <p class="card-text">Location: {{event.location}}</p>
          <p class="card-text">{{event.details}}</p>
          <p class="card-text">Time: {{event.event_date}}</p>

          {% with signed_up=event.signed_up.all %}
            <p>Number signed up: {{ signed_up.count }}</p>
            <table class="table table-hover">
              {% for atendee in signed_up %}
                <tr>
                  <td>
                    <a href="{% url 'profile' atendee.id %}">
                      {{atendee.username}}
                    </a>
                  </td>
                </tr>

              {% endfor %}
            </table>
          {% endwith %}
          <br>


          <p class="card-text text-muted d-inline">Created: {{event.create_date}}</p>
          <p class="card-text text-muted d-inline">Last Modified: {{event.last_modified}}</p>
        </div>
      </div>
    {%endfor%}
  {% endblock content%}
